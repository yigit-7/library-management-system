# ===================================================================
# SPRING BOOT APPLICATION CONFIGURATION
# ===================================================================

# Name of the application
spring.application.name=library-management-system

# ===================================================================
# LOGGING CONFIGURATION
# ===================================================================

# Console Log Pattern: Time Level [Thread] Logger - Message (With Colors)
# %clr(...) adds ANSI colors.
logging.pattern.console=%clr(%d{HH:mm:ss}){faint} %clr(%-5level) %clr([%thread]){magenta} %clr(%logger{40}){cyan} %clr(-){faint} %msg%n

# ===================================================================
# DATABASE & JPA CONFIGURATION
# ===================================================================

# Logging level for Hibernate SQL binding parameters (useful for debugging)
logging.level.org.hibernate.orm.jdbc.bind=TRACE

# Automatically update the database schema based on entity classes
# Options: none, validate, update, create, create-drop
spring.jpa.hibernate.ddl-auto=update

# Show SQL queries generated by Hibernate in the console
spring.jpa.show-sql=true

# Format the SQL queries for better readability
spring.jpa.properties.hibernate.format_sql=true

# Disable Open Session In View pattern to prevent lazy loading issues outside transactions
spring.jpa.open-in-view=false

# Batch size for Hibernate fetching to improve performance (N+1 problem mitigation)
spring.jpa.properties.hibernate.default_batch_fetch_size=100

# PostgreSQL Connection Settings (Values are injected from environment variables)
spring.datasource.url=${SPRING_DATASOURCE_URL}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD}

# ===================================================================
# JSON SERIALIZATION
# ===================================================================

# Write dates as ISO-8601 strings instead of timestamps (e.g., "2023-10-25" vs 1698230000)
spring.jackson.serialization.write-dates-as-timestamps=false

# ===================================================================
# ACTUATOR & MONITORING
# ===================================================================

# Expose health check endpoint for monitoring (e.g., /actuator/health)
management.endpoints.web.exposure.include=health

# ===================================================================
# DEVELOPER TOOLS
# ===================================================================

# Enable LiveReload for automatic browser refresh during development
spring.devtools.livereload.enabled=true

# Poll interval for checking file changes to trigger restart
spring.devtools.restart.poll-interval=1s

# ===================================================================
# SECURITY & JWT CONFIGURATION
# ===================================================================

# Secret key used for signing JWT tokens (Must be kept secure)
application.security.jwt.secret-key=${JWT_SECRET_KEY}

# Access token expiration time in milliseconds (e.g., 900000 = 15 minutes)
application.security.jwt.access-token.expiration=900000

# Refresh token expiration time in milliseconds (e.g., 2592000000 = 30 days)
application.security.jwt.refresh-token.expiration=2592000000

# Cron expression for cleaning up expired refresh tokens from the database
# Runs every day at 3 AM
application.security.jwt.refresh-token.cleanup-cron=0 0 3 * * *

# ===================================================================
# BUSINESS LOGIC CONFIGURATION
# ===================================================================

# --- General Library Configuration ---

# Time unit used for fine calculation logic AND loan due soon calculation.
# Options: DAYS (Standard), HOURS, MINUTES, SECONDS (For testing)
application.library.time-unit=DAYS

# --- Loan Configuration ---

# Maximum number of active loans a user can have simultaneously
application.library.loan.max-active=5

# Default loan duration in days
application.library.loan.due-days=14

# Number of time units before due date to send "Due Soon" notification
application.library.loan.due-soon-amount=3

# Cron expression for the LoanScheduler to check for overdue loans and send notifications
# Format: second minute hour day-of-month month day-of-week
# Default: 0 * * * * * (Every minute - for testing/demo purposes)
# Production Recommendation: 0 0 9 * * * (Every day at 9 AM)
application.library.loan.scheduler.cron=0 0 9 * * *

# --- Fine Configuration ---

# Maximum unpaid fine amount a user can have before being blocked from borrowing new books
application.library.fine.max-unpaid-amount=4000

# Base fine amount charged per time unit (e.g., 1.5 currency units per day)
application.library.fine.amount-per-time-unit=1.5

# Multiplier for progressive fine calculation (e.g., fines double after the threshold)
# Used by ProgressiveFineCalculationStrategy
application.library.fine.progressive-multiplier=2.0

# (2) TIME THRESHOLD: The number of time units (e.g., 7 days) after which the progressive multiplier applies
application.library.fine.progressive-time-threshold=2

# (1) USER THRESHOLD: If a user has more than X unpaid fines, switch to Progressive Strategy
application.library.fine.user-bad-history-threshold=5

# Maximum fine cap relative to the book's price (e.g., fine cannot exceed 3x the book price)
application.library.fine.book-price-multiplier=3.0

# ===================================================================
# NOTIFICATION CONFIGURATION
# ===================================================================

# Default communication channels for each notification category
# If a user hasn't set preferences, these defaults are used.
# Channels: EMAIL, SMS, PUSH_NOTIFICATION

# Critical: Book is overdue
app.notification.defaults.LOAN_OVERDUE=EMAIL,SMS

# Warning: Book is due soon
app.notification.defaults.LOAN_DUE_SOON=EMAIL

# Informational: A fine has been issued
app.notification.defaults.FINE_ISSUED=EMAIL,SMS

# Receipt: A fine has been paid
app.notification.defaults.FINE_PAID=EMAIL

# General: Library announcements
app.notification.defaults.GENERAL_ANNOUNCEMENT=EMAIL

# ===================================================================
# MAIL CONFIGURATION (SMTP)
# ===================================================================

# SMTP Server Host (e.g., smtp.gmail.com for Gmail)
spring.mail.host=smtp.gmail.com

# SMTP Server Port (587 for TLS, 465 for SSL)
spring.mail.port=587

# SMTP Username (Your email address) - Injected from environment variable
spring.mail.username=${SPRING_MAIL_USERNAME}

# SMTP Password (App Password for Gmail) - Injected from environment variable
spring.mail.password=${SPRING_MAIL_PASSWORD}

# Enable SMTP Authentication
spring.mail.properties.mail.smtp.auth=true

# Enable STARTTLS for secure communication
spring.mail.properties.mail.smtp.starttls.enable=true

# Connection timeout in milliseconds
spring.mail.properties.mail.smtp.connectiontimeout=5000

# Read timeout in milliseconds
spring.mail.properties.mail.smtp.timeout=5000

# Write timeout in milliseconds
spring.mail.properties.mail.smtp.writetimeout=5000
